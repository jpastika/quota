<% provide(:title, "Contact")%>
<% @nav_caret = "contacts" %>
<div class="body">
	<div class="body-right pull-right">
		<div class="row-fluid">
			<%= link_to raw("<i class=""icon-edit""></i>&nbsp;&nbsp;Change contact details"), edit_contact_path(@contact.pub_key), :class => 'btn btn-primary' %>
		</div>
	</div>
	<div class="body-left">
		<div class="">
			<% flash.each do |key, value| %>
				<div class="alert alert-<%= key %> fade in">
			      <a class="close" data-dismiss="alert" href="#">&times;</a>
			      <%= value %>
			    </div>
			<% end %>
		</div>
		<div class="page-title-container">
			<div class="return-nav pull-left">
				<%= link_to raw("<i class=""icon-circle-arrow-left""></i>return to contacts"), contacts_path %>
			</div>
			<div class="page-title">
				&nbsp;
			</div>
		</div>
		<div class="parent-page">
			<div id="main_body_container" class="">
				<div class="row-fluid section-form-plain">
					<div class="span8">
						<div id="contact">
							<h3><%= @contact.name %></h3>
							<div class="control-group">
								<div class="controls contact_title">
									<%= @contact.title %>
								</div>
							</div>
							<div class="control-group">
								<div class="controls company_name">
									<%= @contact.company.name unless @contact.company.nil? %>
								</div>
							</div>
							<br>
							<div id="contact_phones">
								<% @contact.phones.each do |phone| %>
									<span><%= phone.name %></span> <span><%= phone.val %></span>
								<% end %>
							</div>
							<br>
							<div id="contact_emails">
								<% @contact.emails.each do |email| %>
									<span><%= email.name %></span> <span><%= email.val %></span>
								<% end %>
							</div>
							<br>
							<div id="contact_urls">
								<% @contact.urls.each do |url| %>
									<span><%= url.name %></span> <span><%= url.val %></span>
								<% end %>
							</div>
							<br>
							<div id="contact_addresses">
								<% @contact.addresses.each do |address| %>
									<span><%= address.name %></span> <span><%= address.street1 %><br><%= address.city %> <%= address.state %> <%= address.zip %><br><%= address.country %></span>
								<% end %>
							</div>
						</div>
					</div>
					<div class="span4">
						<div>
						<% if @contact_type == "Company" %>
							<div class="section-heading">
								<h3>Contacts</h3>
							</div>
							<% @contact.people.each do |contact| %>				
							<div class="show-field">
								<%= link_to "#{ contact.name }", contact_path(contact.pub_key) %>
							</div>
							<% end %>
						<% else %>
							<div class="row-fluid">
								<%= link_to "#{ @company.name }", contact_path(@company.pub_key) %>
							</div>
							<% @company.phones.each do |phone| %>				
							<div class="show-field">
								<span class="show-label"><%= phone.name %></span>
								<span class="show-value"><%= phone.val %></span>
							</div>
							<% end %>

							<% @company.emails.each do |email| %>				
							<div class="show-field">
								<span class="show-label"><%= email.name %></span>
								<span class="show-value"><%= email.val %></span>
							</div>
							<% end %>

							<% @company.urls.each do |url| %>				
							<div class="show-field">
								<span class="show-label"><%= url.name %></span>
								<span class="show-value"><%= url.val %></span>
							</div>
							<% end %>

							<% @company.addresses.each do |address| %>				
							<div class="show-field">
								<span class="show-label"><%= address.name %></span>
								<span class="show-value"><%= address.street1 %><br><%= address.city %> <%= address.state %> <%= address.zip %><br><%= address.country %></span>
							</div>
							<% end %>
						<% end %>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script language="javascript">
	$(function(){
			// if(gon.contact_types){
			// 		  		this.contact_types = new Quota.Collections.ContactTypes(gon.contact_types);
			// 			}
			// 			else{
			// 				this.contact_types = new Quota.Collections.ContactTypes();
			// 				this.contact_types.fetch();
			// 			}
			// 			
			// 			if(gon.companies){
			// 				this.companies = new Quota.Collections.Companies(gon.companies);
			// 			}
			// 			else{
			// 				this.companies = new Quota.Collections.Companies();
			// 				this.companies.fetch();
			// 			}
			// 			
			// 			if(gon.contact){
			// 				this.contact = new Quota.Models.Contact(gon.contact);
			// 				// if(gon.contact_phones){
			// 				// 					this.contact.phones.add(gon.contact_phones);
			// 				// 				}
			// 				// 				else{
			// 					// this.contact.phones = new Quota.Collections.ContactPhones();
			// 					this.contact.phones.fetch();
			// 				// }
			// 				// 				if(gon.contact_emails){
			// 				// 					this.contact.emails.add(gon.contact_emails);
			// 				// 				}
			// 				// 				else{
			// 					// this.contact.emails = new Quota.Collections.ContactEmails();
			// 					this.contact.emails.fetch();
			// 				// }
			// 				// 				if(gon.contact_urls){
			// 				// 					this.contact.urls.add(gon.contact_urls);
			// 				// 				}
			// 				// 				else{
			// 					// this.contact.urls = new Quota.Collections.ContactUrls();
			// 					this.contact.urls.fetch();
			// 				// }
			// 				// 				if(gon.contact_addresses){
			// 				// 					this.contact.addresses.add(gon.contact_addresses);
			// 				// 				}
			// 				// 				else{
			// 					// this.contact.addresses = new Quota.Collections.ContactAddresses();
			// 					this.contact.addresses.fetch();
			// 				// }
			// 			}
			// 			else{
			// 				this.contact = new Quota.Models.Contact();
			// 				this.contact.fetch();
			// 			}
			// 			
			// 			
			// 			window.vent = _.extend({}, Backbone.Events);
			// 			
			// 			var view_contact = new Quota.Views.ShowContact({model:this.contact, contact_types: this.contact_types, companies: this.companies, vent: vent});
			// 			$('#contact').html(view_contact.render().el);
	});	
</script>