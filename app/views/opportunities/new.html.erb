<% provide(:title, "Add Opportunity") %>
<div class="span8">
	<div class="row-fluid">
		<% flash.each do |key, value| %>
			<div class="alert alert-<%= key %> fade in">
		      <a class="close" data-dismiss="alert" href="#">&times;</a>
		      <%= value %>
		    </div>
		<% end %>
	</div>
	<div class="parent-page">
		<div class="row-fluid">
			<%= simple_form_for(@opportunity) do |f| %>
				<div class="row-fluid">
					<% if f.error_notification %>
					    <div class="alert alert-error fade in">
					      <a class="close" data-dismiss="alert" href="#">&times;</a>
					      <%= f.error_notification %>
					    </div>
					<% end %>
				</div>
				<div id="opportunity">
				</div>
				<%= f.button :submit, "Create Opportunity", class: "btn btn-large btn-primary" %>
			<% end %>
		</div>
	</div>
</div>
<% content_for :sidebar_right do %>
<div class="span2">
	<div>
		<div class="row-fluid">
			<span class="btn btn-primary">Save</span>
		</div>
		<div class="row-fluid">
			
		</div>
	</div>
</div>
<% end %>

<script language="javascript">
	$(function(){
		// this.milestones = new Quota.Collections.Milestones(gon.milestones);
		this.companies = new Quota.Collections.Companies(gon.companies);
		this.milestones = new Quota.Collections.Milestones(gon.milestones);
		this.sales_reps = new Quota.Collections.SalesReps(gon.sales_reps);
	
		if(gon.opportunity){
			this.opportunity = new Quota.Models.Opportunity(gon.opportunity);
		}
		else{
			this.opportunity = new Quota.Models.Opportunity();
			this.opportunity.fetch();
		}
		
		window.vent = _.extend({}, Backbone.Events);
	
		var view_opportunity = new Quota.Views.EditOpportunity({model:this.opportunity, milestones: this.milestones, companies: this.companies, sales_reps: this.sales_reps, vent: vent});
		$('#opportunity').html(view_opportunity.render().el);
	});	
	
	$.fn.placeholder();
</script>